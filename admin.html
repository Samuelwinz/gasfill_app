<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GasFill Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f766e;
            --primary-light: #14b8a6;
            --secondary: #1e40af;
            --accent: #f59e0b;
            --success: #059669;
            --error: #dc2626;
            --warning: #d97706;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --admin-primary: #7c3aed;
            --admin-secondary: #a855f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Admin Header */
        .admin-header {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .admin-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            min-height: 60px;
        }

        .admin-logo {
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1001;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .admin-logo::before {
            content: 'üëë';
            font-size: 1.5rem;
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            gap: 4px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            z-index: 1001;
            position: relative;
            min-width: 44px;
            min-height: 44px;
            justify-content: center;
            align-items: center;
        }

        /* TESTING MODE: Show mobile menu toggle on all screen sizes */
        .mobile-menu-toggle {
            display: flex !important;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .mobile-menu-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .mobile-menu-toggle:focus {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            outline-offset: 2px;
        }

        .mobile-menu-toggle span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 3px;
            transition: all 0.3s ease;
            transform-origin: center;
            display: block;
        }

        .mobile-menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        .mobile-menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1001;
            flex-shrink: 0;
        }

        .admin-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Admin Layout */
        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: calc(100vh - 80px);
            max-width: 1400px;
            margin: 0 auto;
            gap: 2rem;
            padding: 2rem;
            position: relative;
        }

        /* Sidebar */
        .admin-sidebar {
            background: var(--surface);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
            transition: all 0.3s ease;
        }

        /* TESTING MODE: Force mobile sidebar behavior for all screen sizes */
        .admin-sidebar {
            position: fixed !important;
            top: 0 !important;
            left: -280px !important;
            width: 280px !important;
            height: 100vh !important;
            z-index: 1000 !important;
            transition: left 0.3s ease !important;
            border-radius: 0 !important;
            padding-top: 100px !important;
            overflow-y: auto !important;
            background: var(--surface) !important;
            box-shadow: var(--shadow-lg) !important;
        }

        .admin-sidebar.mobile-open {
            left: 0 !important;
        }

        /* TESTING MODE: Force single column layout */
        .admin-container {
            grid-template-columns: 1fr !important;
            gap: 1rem !important;
            padding: 1rem !important;
        }

        /* Mobile Sidebar Overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* TESTING MODE: Ensure overlay is always available */
        .sidebar-overlay {
            display: block !important;
        }

        /* Mobile Sidebar */
        @media (max-width: 1024px) {
            .admin-sidebar {
                position: fixed;
                top: 0;
                left: -280px;
                width: 280px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                border-radius: 0;
                padding-top: 100px;
                overflow-y: auto;
                background: var(--surface);
                box-shadow: var(--shadow-lg);
            }

            .admin-sidebar.mobile-open {
                left: 0;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .admin-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }
        }

        /* Medium screens adjustments */
        @media (max-width: 896px) {
            .admin-header {
                padding: 0.875rem 1.5rem;
            }

            .admin-logo {
                font-size: 1.6rem;
            }

            .admin-user-info {
                gap: 0.75rem;
            }

            .admin-user-info > div:not(.admin-user-avatar):not(.logout-btn) {
                display: none;
            }
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: var(--admin-primary);
            color: white;
            transform: translateX(4px);
        }

        .sidebar-nav .icon {
            font-size: 1.2rem;
        }

        /* Main Content */
        .admin-main {
            background: var(--surface);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--surface) 0%, #f1f5f9 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--admin-primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-weight: 500;
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        /* Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: var(--surface);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: var(--shadow);
            font-size: 0.9rem;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .admin-table th {
            background: var(--background);
            font-weight: 600;
            color: var(--text);
            position: sticky;
            top: 0;
            font-size: 0.875rem;
        }

        .admin-table tr:hover {
            background: var(--background);
        }

        /* Responsive Table */
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
        }

        .table-container::-webkit-scrollbar {
            height: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--background);
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--admin-primary);
            border-radius: 4px;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-accepted,
        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-delivered,
        .status-completed {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Action Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--admin-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--admin-secondary);
        }

        .btn-secondary {
            background: var(--text-muted);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .admin-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
                padding-left: 1rem;
            }

            .admin-sidebar {
                position: static;
                margin-bottom: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }

            .admin-main {
                padding: 1.5rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .admin-table th,
            .admin-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.875rem;
            }

            /* Hide less important columns on mobile */
            .admin-table .hide-mobile {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .admin-nav {
                padding: 0;
            }

            .admin-header {
                padding: 0.75rem 1rem;
            }

            .admin-logo {
                font-size: 1.5rem;
            }

            .admin-user-info {
                gap: 0.5rem;
            }

            .admin-user-info > div:not(.admin-user-avatar):not(.logout-btn) {
                display: none;
            }

            .admin-user-avatar {
                width: 36px;
                height: 36px;
                font-size: 0.875rem;
            }

            .logout-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .admin-main {
                padding: 1rem;
            }

            .admin-table {
                font-size: 0.8rem;
            }

            .admin-table th,
            .admin-table td {
                padding: 0.5rem 0.25rem;
            }

            .btn {
                padding: 0.375rem 0.75rem;
                font-size: 0.875rem;
            }

            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            /* Stack dashboard overview */
            .dashboard-overview {
                display: block !important;
            }

            .dashboard-overview > div {
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 480px) {
            .admin-header {
                padding: 0.5rem 0.75rem;
            }

            .admin-nav {
                min-height: 50px;
            }

            .admin-logo {
                font-size: 1.25rem;
            }

            .admin-logo::before {
                font-size: 1.25rem;
            }

            .admin-user-info {
                gap: 0.25rem;
            }

            .admin-user-avatar {
                width: 32px;
                height: 32px;
                font-size: 0.75rem;
            }

            .logout-btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.75rem;
                min-width: auto;
            }

            .mobile-menu-toggle {
                padding: 0.375rem;
            }

            .mobile-menu-toggle span {
                width: 20px;
                height: 2px;
            }

            .admin-container {
                padding: 0.5rem;
            }

            .admin-main {
                padding: 0.75rem;
                border-radius: 0.5rem;
            }

            .stat-card {
                padding: 0.75rem;
                text-align: center;
            }

            .stat-number {
                font-size: 1.75rem;
            }

            .stat-icon {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }

            /* Mobile-first table design */
            .admin-table-mobile {
                display: block;
            }

            .admin-table-mobile thead {
                display: none;
            }

            .admin-table-mobile tr {
                display: block;
                margin-bottom: 1rem;
                background: var(--surface);
                border-radius: 0.5rem;
                box-shadow: var(--shadow);
                padding: 1rem;
            }

            .admin-table-mobile td {
                display: block;
                padding: 0.25rem 0;
                border: none;
                text-align: left;
            }

            .admin-table-mobile td:before {
                content: attr(data-label) ": ";
                font-weight: 600;
                color: var(--admin-primary);
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn,
            .sidebar-nav a,
            .mobile-menu-toggle {
                min-height: 44px;
                min-width: 44px;
            }

            .sidebar-nav a {
                padding: 1rem;
                margin-bottom: 0.25rem;
            }

            .admin-table td,
            .admin-table th {
                padding: 1rem 0.75rem;
            }
        }

        /* Login Form Styles */
        .admin-login {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
        }

        .login-card {
            background: var(--surface);
            padding: 3rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--admin-primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-title::before {
            content: 'üëë';
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--admin-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--admin-primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-btn:hover {
            background: var(--admin-secondary);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Admin Login Section -->
    <div id="admin-login-section" class="admin-login">
        <div class="login-card">
            <h1 class="login-title">GasFill Admin</h1>
            <div id="login-error" class="error-message" style="display: none;"></div>
            <form id="admin-login-form">
                <div class="form-group">
                    <label class="form-label" for="admin-email">Admin Email</label>
                    <input type="email" class="form-input" id="admin-email" required value="admin@gasfill.com" aria-label="Admin Email">
                </div>
                <div class="form-group">
                    <label class="form-label" for="admin-password">Password</label>
                    <input type="password" class="form-input" id="admin-password" required value="admin123" aria-label="Password">
                </div>
                <div class="form-group">
                    <label class="form-label" for="admin-key">Admin Key</label>
                    <input type="password" class="form-input" id="admin-key" required placeholder="Enter admin key" aria-label="Admin Key">
                </div>
                <button type="submit" class="login-btn" id="login-btn">
                    <span id="login-loader" class="loading" style="display: none;"></span>
                    <span id="login-text">Login to Dashboard</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="admin-dashboard-section" style="display: none;">
        <!-- Admin Header -->
        <header class="admin-header">
            <nav class="admin-nav">
                <div class="admin-logo">GasFill Admin</div>
                
                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobile-menu-toggle" onclick="toggleMobileMenu()" 
                        title="Toggle mobile menu" aria-label="Toggle navigation menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <div class="admin-user-info">
                    <div class="admin-user-avatar" id="admin-avatar">A</div>
                    <div>
                        <div id="admin-username">Admin User</div>
                        <div style="font-size: 0.875rem; opacity: 0.8;" id="admin-email-display">admin@gasfill.com</div>
                    </div>
                    <button class="logout-btn" onclick="adminLogout()">Logout</button>
                </div>
                
                <!-- Debug Info (temporary) -->
                <div id="debug-info" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 0.5rem; font-size: 0.75rem; border-radius: 0.25rem; z-index: 9999; display: none;">
                    <div>Screen: <span id="screen-size">-</span></div>
                    <div>Mobile Menu: <span id="mobile-menu-status">-</span></div>
                    <div>Toggle Visible: <span id="toggle-visible">-</span></div>
                </div>
            </nav>
        </header>

        <!-- Admin Container -->
        <div class="admin-container">
            <!-- Sidebar Overlay for Mobile -->
            <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeMobileMenu()"></div>
            
            <!-- Sidebar -->
            <aside class="admin-sidebar" id="admin-sidebar">
                <ul class="sidebar-nav">
                    <li><a href="#" onclick="showAdminSection('dashboard'); closeMobileMenu();" class="active">
                        <span class="icon">üìä</span> Dashboard
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('users'); closeMobileMenu();">
                        <span class="icon">üë•</span> Users
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('riders'); closeMobileMenu();">
                        <span class="icon">üèçÔ∏è</span> Riders
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('orders'); closeMobileMenu();">
                        <span class="icon">üì¶</span> Orders
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('services'); closeMobileMenu();">
                        <span class="icon">üîß</span> Services
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('analytics'); closeMobileMenu();">
                        <span class="icon">üìà</span> Analytics
                    </a></li>
                    <li><a href="#" onclick="showAdminSection('settings'); closeMobileMenu();">
                        <span class="icon">‚öôÔ∏è</span> Settings
                    </a></li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="admin-main">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="admin-section active">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">Dashboard Overview</h2>
                    
                    <div class="dashboard-grid" id="dashboard-stats">
                        <!-- Stats will be loaded here -->
                    </div>

                    <div class="dashboard-overview" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                        <div>
                            <h3 style="margin-bottom: 1rem;">Recent Orders</h3>
                            <div id="recent-orders" style="background: var(--surface); border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow);">
                                Loading...
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 1rem;">Recent Services</h3>
                            <div id="recent-services" style="background: var(--surface); border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow);">
                                Loading...
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="users-section" class="admin-section">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">User Management</h2>
                    
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="refreshUsers()">
                            üîÑ Refresh Users
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th class="hide-mobile">Phone</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th class="hide-mobile">Orders</th>
                                    <th class="hide-mobile">Services</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 2rem;">Loading users...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Riders Verification Section -->
                <section id="riders-section" class="admin-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h2 style="margin: 0; color: var(--admin-primary); font-size: 2rem; font-weight: 700;">üèçÔ∏è Rider Verification</h2>
                            <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.95rem;">Review and approve rider documents</p>
                        </div>
                        <button class="btn" onclick="refreshRiders()" style="background: var(--admin-primary); color: white; padding: 0.75rem 1.5rem; font-weight: 600; box-shadow: 0 2px 8px rgba(124,58,237,0.3);">
                            üîÑ Refresh
                        </button>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;" id="rider-stats">
                        <!-- Stats will be populated here -->
                    </div>
                    
                    <!-- Filter Tabs -->
                    <div style="margin-bottom: 1.5rem; background: white; border-radius: 12px; padding: 0.5rem; display: inline-flex; gap: 0.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <button class="filter-tab active" onclick="filterRidersByStatus('all')" id="filter-all" style="padding: 0.75rem 1.5rem; border: none; background: var(--admin-primary); color: white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            All Riders
                        </button>
                        <button class="filter-tab" onclick="filterRidersByStatus('pending')" id="filter-pending" style="padding: 0.75rem 1.5rem; border: none; background: transparent; color: var(--text); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            ‚è≥ Pending
                        </button>
                        <button class="filter-tab" onclick="filterRidersByStatus('approved')" id="filter-approved" style="padding: 0.75rem 1.5rem; border: none; background: transparent; color: var(--text); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            ‚úÖ Approved
                        </button>
                        <button class="filter-tab" onclick="filterRidersByStatus('rejected')" id="filter-rejected" style="padding: 0.75rem 1.5rem; border: none; background: transparent; color: var(--text); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            ‚ùå Rejected
                        </button>
                    </div>

                    <div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); overflow: hidden;">
                        <table class="admin-table" style="margin: 0;">
                            <thead style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                                <tr>
                                    <th style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">ID</th>
                                    <th style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Rider</th>
                                    <th style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Contact</th>
                                    <th class="hide-mobile" style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">License</th>
                                    <th class="hide-mobile" style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Vehicle</th>
                                    <th style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Status</th>
                                    <th class="hide-mobile" style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Deliveries</th>
                                    <th style="padding: 1rem; font-weight: 600; color: var(--admin-primary);">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="riders-table-body">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 3rem; color: var(--text-muted);">
                                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîÑ</div>
                                        <div style="font-size: 1.1rem;">Loading riders...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Document Viewer Modal -->
                <div id="documentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; padding: 2rem; position: relative;">
                        <button type="button" onclick="closeDocumentModal()" style="position: absolute; top: 1rem; right: 1rem; background: #dc2626; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px;">‚úï</button>
                        
                        <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-size: 1.5rem;">Rider Documents</h3>
                        
                        <div id="documentContent">
                            <div style="margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 0.5rem; color: #374151;">Rider Information</h4>
                                <div id="riderInfo" style="background: #f9fafb; padding: 1rem; border-radius: 8px;">
                                    <!-- Rider info will be populated here -->
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                                <div>
                                    <h4 style="margin-bottom: 0.5rem; color: #374151;">License Photo</h4>
                                    <div id="licensePhotoContainer" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 0.5rem; min-height: 200px; display: flex; align-items: center; justify-content: center; background: #f9fafb;">
                                        <span style="color: #9ca3af;">No photo uploaded</span>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 style="margin-bottom: 0.5rem; color: #374151;">Vehicle Photo</h4>
                                    <div id="vehiclePhotoContainer" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 0.5rem; min-height: 200px; display: flex; align-items: center; justify-content: center; background: #f9fafb;">
                                        <span style="color: #9ca3af;">No photo uploaded</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                <button type="button" class="btn" style="background: #10b981; color: white;" onclick="approveFromModal()">
                                    ‚úì Approve
                                </button>
                                <button type="button" class="btn" style="background: #dc2626; color: white;" onclick="rejectFromModal()">
                                    ‚úó Reject
                                </button>
                                <button type="button" class="btn" onclick="closeDocumentModal()">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <section id="orders-section" class="admin-section">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">Order Management</h2>
                    
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="refreshOrders()">
                            üîÑ Refresh Orders
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th class="hide-mobile">Items</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th class="hide-mobile">Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 2rem;">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="services-section" class="admin-section">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">Service Management</h2>
                    
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="refreshServices()" id="refresh-services-btn">
                            üîÑ Refresh Services
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Service ID</th>
                                    <th>Customer</th>
                                    <th>Type</th>
                                    <th class="hide-mobile">Address</th>
                                    <th class="hide-mobile">Date</th>
                                    <th>Status</th>
                                    <th class="hide-mobile">Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="services-table-body">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 2rem;">Loading services...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics-section" class="admin-section">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">Analytics & Reports</h2>
                    <p>Advanced analytics coming soon...</p>
                </section>

                <!-- Settings Section -->
                <section id="settings-section" class="admin-section">
                    <h2 style="margin-bottom: 2rem; color: var(--admin-primary); font-size: 2rem;">System Settings</h2>
                    <p>System configuration options coming soon...</p>
                </section>
            </main>
        </div>
    </div>

    <script>
        // Global variables
        const API_BASE = 'http://192.168.8.100:8000/api';
        let adminAuthToken = null;
        let currentAdmin = null;

        // Utility function to safely format dates
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return 'Invalid Date';
                }
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                console.error('Date formatting error:', error);
                return 'Invalid Date';
            }
        }

        // Utility function for API calls
        async function adminApiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(adminAuthToken && { 'Authorization': `Bearer ${adminAuthToken}` })
                },
                ...options
            };

            console.log(`üåê API Call: ${options.method || 'GET'} ${url}`);

            try {
                const response = await fetch(url, config);
                
                console.log(`üì° Response: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    let errorMessage;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.detail || errorData.message || response.statusText;
                    } catch {
                        errorMessage = response.statusText;
                    }
                    throw new Error(`HTTP ${response.status}: ${errorMessage}`);
                }
                
                const data = await response.json();
                console.log(`‚úÖ API Success:`, data);
                return data;
            } catch (error) {
                console.error(`‚ùå API Error:`, error);
                
                // Check if it's a network error
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Network error - Please check if the server is running');
                }
                
                throw error;
            }
        }

        // Admin Authentication
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const adminKey = document.getElementById('admin-key').value;
            
            const loader = document.getElementById('login-loader');
            const text = document.getElementById('login-text');
            const errorDiv = document.getElementById('login-error');
            
            loader.style.display = 'block';
            text.style.display = 'none';
            errorDiv.style.display = 'none';
            
            try {
                const data = await adminApiCall('/auth/admin-login', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        admin_key: adminKey
                    })
                });
                
                adminAuthToken = data.token;
                currentAdmin = data.user;
                
                // Store admin session
                localStorage.setItem('adminToken', adminAuthToken);
                localStorage.setItem('currentAdmin', JSON.stringify(currentAdmin));
                
                showAdminDashboard();
                loadDashboardData();
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            } finally {
                loader.style.display = 'none';
                text.style.display = 'block';
            }
        });

        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('admin-login-section').style.display = 'none';
            document.getElementById('admin-dashboard-section').style.display = 'block';
            
            // Update admin info in header
            if (currentAdmin) {
                document.getElementById('admin-avatar').textContent = currentAdmin.username.charAt(0).toUpperCase();
                document.getElementById('admin-username').textContent = currentAdmin.username;
                document.getElementById('admin-email-display').textContent = currentAdmin.email;
            }
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const toggle = document.getElementById('mobile-menu-toggle');
            
            if (!sidebar || !overlay || !toggle) {
                console.error('Missing elements for mobile menu:', { 
                    sidebar: !!sidebar, 
                    overlay: !!overlay, 
                    toggle: !!toggle 
                });
                return;
            }

            const isOpen = sidebar.classList.contains('mobile-open');
            
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }

        function openMobileMenu() {
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const toggle = document.getElementById('mobile-menu-toggle');
            
            if (!sidebar || !overlay || !toggle) return;

            sidebar.classList.add('mobile-open');
            overlay.style.display = 'block';
            overlay.classList.add('active');
            toggle.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const toggle = document.getElementById('mobile-menu-toggle');
            
            if (!sidebar || !overlay || !toggle) return;

            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
            toggle.classList.remove('active');
            document.body.style.overflow = '';
            
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
        }

        // Admin logout
        function adminLogout() {
            adminAuthToken = null;
            currentAdmin = null;
            localStorage.removeItem('adminToken');
            localStorage.removeItem('currentAdmin');
            
            document.getElementById('admin-login-section').style.display = 'flex';
            document.getElementById('admin-dashboard-section').style.display = 'none';
            
            // Reset form
            document.getElementById('admin-login-form').reset();
        }

        // Show admin section
        function showAdminSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Update nav buttons
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
                if (link.onclick && link.onclick.toString().includes(sectionName)) {
                    link.classList.add('active');
                }
            });
            
            // Show selected section
            document.getElementById(`${sectionName}-section`).classList.add('active');
            
            // Load section data
            switch (sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'riders':
                    loadRiders();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'services':
                    loadServices();
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const dashboardData = await adminApiCall('/admin/dashboard');
                
                // Update stats cards
                const statsContainer = document.getElementById('dashboard-stats');
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-number">${dashboardData.users.total}</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-number">${dashboardData.orders.total}</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîß</div>
                        <div class="stat-number">${dashboardData.services.total}</div>
                        <div class="stat-label">Total Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-number">‚Çµ${dashboardData.revenue.total.toFixed(2)}</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                `;
                
                // Update recent activities
                const recentOrders = document.getElementById('recent-orders');
                const recentServices = document.getElementById('recent-services');
                
                if (dashboardData.recent_activity.recent_orders.length > 0) {
                    recentOrders.innerHTML = dashboardData.recent_activity.recent_orders.map(order => `
                        <div style="padding: 0.5rem; border-bottom: 1px solid var(--border);">
                            <strong>Order #${order.id}</strong> - ‚Çµ${order.total.toFixed(2)}
                            <br><small>Status: ${order.status}</small>
                        </div>
                    `).join('');
                } else {
                    recentOrders.innerHTML = '<p>No recent orders</p>';
                }
                
                if (dashboardData.recent_activity.recent_services.length > 0) {
                    recentServices.innerHTML = dashboardData.recent_activity.recent_services.map(service => `
                        <div style="padding: 0.5rem; border-bottom: 1px solid var(--border);">
                            <strong>${service.service_type}</strong> - ‚Çµ${service.total_cost.toFixed(2)}
                            <br><small>Status: ${service.status}</small>
                        </div>
                    `).join('');
                } else {
                    recentServices.innerHTML = '<p>No recent services</p>';
                }
                
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const users = await adminApiCall('/admin/users');
                const tbody = document.getElementById('users-table-body');
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No users found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td data-label="ID">${user.id}</td>
                        <td data-label="Username">${user.username}</td>
                        <td data-label="Email">${user.email}</td>
                        <td data-label="Phone" class="hide-mobile">${user.phone || 'N/A'}</td>
                        <td data-label="Role"><span class="status-badge ${user.role === 'admin' ? 'status-completed' : 'status-pending'}">${user.role}</span></td>
                        <td data-label="Status"><span class="status-badge ${user.is_active ? 'status-accepted' : 'status-cancelled'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td data-label="Orders" class="hide-mobile">${user.order_count}</td>
                        <td data-label="Services" class="hide-mobile">${user.service_count}</td>
                        <td data-label="Actions">
                            <button class="btn btn-sm ${user.is_active ? 'btn-danger' : 'btn-success'}" 
                                    onclick="toggleUserStatus(${user.id}, ${!user.is_active})">
                                ${user.is_active ? 'Deactivate' : 'Activate'}
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load users:', error);
            }
        }

        // Load orders
        async function loadOrders() {
            try {
                const orders = await adminApiCall('/admin/orders');
                const tbody = document.getElementById('orders-table-body');
                
                if (orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No orders found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td data-label="Order ID">#${order.id}</td>
                        <td data-label="Customer">${order.customer_name}</td>
                        <td data-label="Items" class="hide-mobile">${order.items.length} item(s)</td>
                        <td data-label="Total">‚Çµ${order.total.toFixed(2)}</td>
                        <td data-label="Status"><span class="status-badge status-${order.status}">${order.status}</span></td>
                        <td data-label="Date" class="hide-mobile">${formatDate(order.created_at)}</td>
                        <td data-label="Actions">
                            <select onchange="updateOrderStatus('${order.id}', this.value)" class="btn btn-sm" style="max-width: 120px;">
                                <option value="${order.status}">${order.status}</option>
                                <option value="pending">pending</option>
                                <option value="accepted">accepted</option>
                                <option value="assigned">assigned</option>
                                <option value="delivered">delivered</option>
                                <option value="cancelled">cancelled</option>
                            </select>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load orders:', error);
            }
        }

        // Load services
        async function loadServices() {
            console.log('üîÑ Loading services...');
            const tbody = document.getElementById('services-table-body');
            
            try {
                // Show loading state
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;">üîÑ Loading services...</td></tr>';
                
                const services = await adminApiCall('/admin/services');
                console.log('‚úÖ Services loaded:', services);
                
                if (services.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No services found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = services.map(service => `
                    <tr>
                        <td data-label="Service ID">#${service.id}</td>
                        <td data-label="Customer">${service.customer_name}</td>
                        <td data-label="Type">${service.service_type}</td>
                        <td data-label="Address" class="hide-mobile">${service.service_address}</td>
                        <td data-label="Date" class="hide-mobile">${service.service_date}</td>
                        <td data-label="Status"><span class="status-badge status-${service.status}">${service.status}</span></td>
                        <td data-label="Cost" class="hide-mobile">‚Çµ${service.total_cost.toFixed(2)}</td>
                        <td data-label="Actions">
                            <select onchange="updateServiceStatus('${service.id}', this.value)" class="btn btn-sm" style="max-width: 120px;">
                                <option value="${service.status}">${service.status}</option>
                                <option value="pending">pending</option>
                                <option value="accepted">accepted</option>
                                <option value="assigned">assigned</option>
                                <option value="completed">completed</option>
                                <option value="cancelled">cancelled</option>
                            </select>
                        </td>
                    </tr>
                `).join('');
                
                console.log('‚úÖ Services table updated successfully');
            } catch (error) {
                console.error('‚ùå Failed to load services:', error);
                tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">
                    ‚ùå Error loading services: ${error.message}
                    <br><button onclick="loadServices()" class="btn btn-primary" style="margin-top: 0.5rem;">Try Again</button>
                </td></tr>`;
            }
        }

        // Admin actions
        async function toggleUserStatus(userId, isActive) {
            try {
                await adminApiCall(`/admin/users/${userId}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ is_active: isActive })
                });
                loadUsers(); // Refresh users table
            } catch (error) {
                alert('Failed to update user status: ' + error.message);
            }
        }

        async function updateOrderStatus(orderId, status) {
            try {
                await adminApiCall(`/admin/orders/${orderId}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status: status })
                });
                loadOrders(); // Refresh orders table
            } catch (error) {
                alert('Failed to update order status: ' + error.message);
            }
        }

        async function updateServiceStatus(serviceId, status) {
            try {
                await adminApiCall(`/admin/services/${serviceId}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status: status })
                });
                loadServices(); // Refresh services table
            } catch (error) {
                alert('Failed to update service status: ' + error.message);
            }
        }

        // Refresh functions
        function refreshUsers() {
            console.log('üîÑ Refreshing users...');
            loadUsers();
        }

        function refreshOrders() {
            console.log('üîÑ Refreshing orders...');
            loadOrders();
        }

        // Rider Management Functions
        let currentRiderFilter = 'all';
        let allRidersData = []; // Store riders data globally
        
        async function loadRiders() {
            try {
                console.log('üì• Loading riders...');
                const response = await adminApiCall('/admin/riders');
                console.log('‚úÖ Riders response:', response);
                allRidersData = response || []; // Store in global variable
                console.log('üìä Total riders loaded:', allRidersData.length);
                
                // Update stats cards
                updateRiderStats(allRidersData);
                
                displayRiders(allRidersData);
            } catch (error) {
                console.error('‚ùå Error loading riders:', error);
                const tbody = document.getElementById('riders-table-body');
                if (tbody) {
                    tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--error);">
                        Failed to load riders: ${error.message}<br>
                        <button class="btn btn-sm" onclick="loadRiders()" style="margin-top: 1rem;">Retry</button>
                    </td></tr>`;
                } else {
                    console.error('‚ùå riders-table-body element not found!');
                }
            }
        }
        
        function updateRiderStats(riders) {
            const pending = riders.filter(r => r.document_status === 'pending').length;
            const approved = riders.filter(r => r.document_status === 'approved').length;
            const rejected = riders.filter(r => r.document_status === 'rejected').length;
            const total = riders.length;
            
            const statsContainer = document.getElementById('rider-stats');
            if (!statsContainer) return;
            
            statsContainer.innerHTML = `
                <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid var(--admin-primary);">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; font-weight: 600;">Total Riders</div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--admin-primary);">${total}</div>
                </div>
                <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #fbbf24;">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; font-weight: 600;">‚è≥ Pending Review</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #f59e0b;">${pending}</div>
                </div>
                <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #10b981;">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; font-weight: 600;">‚úÖ Approved</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #059669;">${approved}</div>
                </div>
                <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #ef4444;">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; font-weight: 600;">‚ùå Rejected</div>
                    <div style="font-size: 2rem; font-weight: 700; color: #dc2626;">${rejected}</div>
                </div>
            `;
        }
        
        function filterRidersByStatus(status) {
            console.log('üîç Filtering riders by status:', status);
            currentRiderFilter = status;
            
            // Update button styles
            document.querySelectorAll('.filter-tab').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text)';
            });
            
            const filterBtn = document.getElementById(`filter-${status}`);
            if (filterBtn) {
                filterBtn.style.background = 'var(--admin-primary)';
                filterBtn.style.color = 'white';
            } else {
                console.error(`‚ùå Filter button not found: filter-${status}`);
            }
            
            displayRiders(allRidersData);
        }
        
        function displayRiders(riders) {
            console.log('üé® Displaying riders...', riders);
            const tbody = document.getElementById('riders-table-body');
            
            if (!tbody) {
                console.error('‚ùå riders-table-body element not found!');
                return;
            }
            
            if (!riders || riders.length === 0) {
                console.log('‚ÑπÔ∏è No riders to display');
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;">No riders found</td></tr>';
                return;
            }
            
            // Filter riders based on current filter
            let filteredRiders = riders;
            if (currentRiderFilter !== 'all') {
                filteredRiders = riders.filter(r => r.document_status === currentRiderFilter);
                console.log(`üîç Filtered to ${currentRiderFilter}:`, filteredRiders.length, 'riders');
            }
            
            if (filteredRiders.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem;">No ${currentRiderFilter} riders found</td></tr>`;
                return;
            }
            
            console.log('‚úèÔ∏è Rendering', filteredRiders.length, 'riders to table');
            
            tbody.innerHTML = filteredRiders.map((rider, index) => {
                const statusConfig = {
                    'pending': { 
                        bg: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', 
                        text: '#92400e', 
                        label: '‚è≥ Pending',
                        border: '#fbbf24'
                    },
                    'approved': { 
                        bg: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)', 
                        text: '#065f46', 
                        label: '‚úÖ Approved',
                        border: '#10b981'
                    },
                    'rejected': { 
                        bg: 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)', 
                        text: '#991b1b', 
                        label: '‚ùå Rejected',
                        border: '#ef4444'
                    }
                };
                const status = statusConfig[rider.document_status] || statusConfig.pending;
                
                return `
                    <tr style="border-bottom: 1px solid #f1f5f9; transition: all 0.2s; ${index % 2 === 0 ? 'background: #fafafa;' : 'background: white;'}">
                        <td style="padding: 1.25rem 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="background: var(--admin-primary); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.85rem;">
                                    ${rider.id}
                                </div>
                            </div>
                        </td>
                        <td style="padding: 1.25rem 1rem;">
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">${rider.username}</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">ID: ${rider.id}</div>
                        </td>
                        <td style="padding: 1.25rem 1rem;">
                            <div style="color: #374151; font-size: 0.9rem;">${rider.email}</div>
                        </td>
                        <td class="hide-mobile" style="padding: 1.25rem 1rem;">
                            <div style="font-size: 0.9rem; color: #374151;">${rider.license_number || '<span style="color: #9ca3af;">Not set</span>'}</div>
                        </td>
                        <td class="hide-mobile" style="padding: 1.25rem 1rem;">
                            <div style="font-weight: 500; color: #374151;">${rider.vehicle_type || 'N/A'}</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">${rider.vehicle_number || 'N/A'}</div>
                        </td>
                        <td style="padding: 1.25rem 1rem;">
                            <span style="background: ${status.bg}; color: ${status.text}; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600; font-size: 0.85rem; display: inline-block; border: 2px solid ${status.border}; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                ${status.label}
                            </span>
                        </td>
                        <td class="hide-mobile" style="padding: 1.25rem 1rem;">
                            <div style="font-size: 1.1rem; font-weight: 600; color: var(--admin-primary);">${rider.total_deliveries || 0}</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">deliveries</div>
                        </td>
                        <td style="padding: 1.25rem 1rem;">
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <button type="button" class="btn btn-sm" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(99,102,241,0.3);" data-action="documents" data-rider-id="${rider.id}">
                                    üìÑ View Docs
                                </button>
                                ${rider.document_status === 'pending' ? `
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button type="button" class="btn btn-sm" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; flex: 1; border: none; padding: 0.5rem 0.75rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(16,185,129,0.3);" data-action="approve" data-rider-id="${rider.id}">
                                            ‚úì
                                        </button>
                                        <button type="button" class="btn btn-sm" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; flex: 1; border: none; padding: 0.5rem 0.75rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(239,68,68,0.3);" data-action="reject" data-rider-id="${rider.id}">
                                            ‚úó
                                        </button>
                                    </div>
                                ` : rider.document_status === 'rejected' ? `
                                    <button type="button" class="btn btn-sm" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(16,185,129,0.3);" data-action="approve" data-rider-id="${rider.id}">
                                        ‚úì Re-approve
                                    </button>
                                ` : `
                                    <button type="button" class="btn btn-sm" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 6px rgba(239,68,68,0.3);" data-action="suspend" data-rider-id="${rider.id}">
                                        üö´ Suspend
                                    </button>
                                `}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Add event listeners to buttons using event delegation
            console.log('üéØ Setting up button event listeners...');
            attachRiderButtonListeners();
        }
        
        function attachRiderButtonListeners() {
            const tbody = document.getElementById('riders-table-body');
            if (!tbody) {
                console.error('‚ùå riders-table-body not found!');
                return;
            }
            
            console.log('üìã Found tbody element:', tbody);
            
            // Remove old listeners if any
            tbody.removeEventListener('click', handleRiderButtonClick);
            // Add new listener
            tbody.addEventListener('click', handleRiderButtonClick);
            console.log('‚úÖ Button listeners attached to tbody');
            
            // Test: Log all buttons
            const buttons = tbody.querySelectorAll('button[data-action]');
            console.log(`üîò Found ${buttons.length} action buttons in table`);
        }
        
        function handleRiderButtonClick(event) {
            console.log('üñ±Ô∏è Click detected on tbody, target:', event.target);
            
            // Check if click is on a button or inside a button
            const button = event.target.closest('button[data-action]');
            
            if (!button) {
                console.log('‚ö†Ô∏è Click was not on an action button');
                return;
            }
            
            const action = button.getAttribute('data-action');
            const riderId = parseInt(button.getAttribute('data-rider-id'));
            
            console.log(`‚úÖ Button clicked: action=${action}, riderId=${riderId}`);
            
            event.preventDefault();
            event.stopPropagation();
            
            switch (action) {
                case 'documents':
                    console.log('üìÑ Calling showRiderDocuments...');
                    showRiderDocuments(riderId);
                    break;
                case 'approve':
                    console.log('‚úÖ Calling verifyRider (approve)...');
                    verifyRider(riderId, true);
                    break;
                case 'reject':
                    console.log('‚ùå Calling verifyRider (reject)...');
                    verifyRider(riderId, false);
                    break;
                case 'view':
                    console.log('üëÅÔ∏è Calling showRiderDetails...');
                    showRiderDetails(riderId);
                    break;
                case 'suspend':
                    console.log('üö´ Calling suspendRider...');
                    suspendRider(riderId);
                    break;
                default:
                    console.warn('‚ö†Ô∏è Unknown action:', action);
            }
        }
        
        async function verifyRider(riderId, isApproved) {
            console.log(`üîê Verifying rider ${riderId}, approved: ${isApproved}`);
            const notes = prompt(isApproved ? 
                'Enter approval notes (optional):' : 
                'Enter rejection reason (required):'
            );
            
            if (!isApproved && !notes) {
                alert('Rejection reason is required');
                return;
            }
            
            try {
                console.log('üì§ Sending verification request...');
                const result = await adminApiCall(`/admin/riders/${riderId}/verify`, {
                    method: 'POST',
                    body: JSON.stringify({
                        is_verified: isApproved,
                        notes: notes || (isApproved ? 'Approved' : 'Rejected')
                    })
                });
                
                console.log('‚úÖ Verification result:', result);
                alert(`Rider ${isApproved ? 'approved' : 'rejected'} successfully`);
                loadRiders();
            } catch (error) {
                console.error('‚ùå Error verifying rider:', error);
                alert('Failed to verify rider: ' + error.message);
            }
        }
        
        async function suspendRider(riderId) {
            const reason = prompt('Enter suspension reason:');
            if (!reason) return;
            
            try {
                await adminApiCall(`/admin/riders/${riderId}/suspend`, {
                    method: 'POST',
                    body: JSON.stringify({
                        is_suspended: true,
                        reason: reason
                    })
                });
                
                alert('Rider suspended successfully');
                loadRiders();
            } catch (error) {
                console.error('‚ùå Error suspending rider:', error);
                alert('Failed to suspend rider: ' + error.message);
            }
        }
        
        function showRiderDetails(riderId) {
            alert(`Rider details for ID ${riderId} - Full details view coming soon`);
        }
        
        // Document Viewer Functions
        let currentModalRiderId = null;
        
        async function showRiderDocuments(riderId) {
            try {
                console.log(`üìÑ Showing documents for rider ${riderId}`);
                console.log('üìä All riders data:', allRidersData);
                
                // Find rider data
                const rider = allRidersData.find(r => r.id === riderId);
                if (!rider) {
                    console.error(`‚ùå Rider ${riderId} not found in allRidersData`);
                    alert('Rider not found');
                    return;
                }
                
                console.log('‚úÖ Found rider:', rider);
                currentModalRiderId = riderId;
                
                // Populate rider info
                document.getElementById('riderInfo').innerHTML = `
                    <p style="margin: 0.5rem 0;"><strong>Name:</strong> ${rider.username}</p>
                    <p style="margin: 0.5rem 0;"><strong>Email:</strong> ${rider.email}</p>
                    <p style="margin: 0.5rem 0;"><strong>License:</strong> ${rider.license_number || 'N/A'}</p>
                    <p style="margin: 0.5rem 0;"><strong>Vehicle:</strong> ${rider.vehicle_type || 'N/A'} - ${rider.vehicle_number || 'N/A'}</p>
                    <p style="margin: 0.5rem 0;"><strong>Status:</strong> 
                        <span style="background: ${rider.document_status === 'approved' ? '#d1fae5' : rider.document_status === 'rejected' ? '#fee2e2' : '#fef3c7'}; 
                                     color: ${rider.document_status === 'approved' ? '#065f46' : rider.document_status === 'rejected' ? '#991b1b' : '#92400e'}; 
                                     padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">
                            ${rider.document_status || 'pending'}
                        </span>
                    </p>
                `;
                
                // Populate license photo
                const licenseContainer = document.getElementById('licensePhotoContainer');
                if (rider.license_photo_url) {
                    licenseContainer.innerHTML = `<img src="http://192.168.8.100:8000${rider.license_photo_url}" style="width: 100%; height: auto; border-radius: 8px;" alt="License Photo">`;
                } else {
                    licenseContainer.innerHTML = '<span style="color: #9ca3af;">No photo uploaded</span>';
                }
                
                // Populate vehicle photo
                const vehicleContainer = document.getElementById('vehiclePhotoContainer');
                if (rider.vehicle_photo_url) {
                    vehicleContainer.innerHTML = `<img src="http://192.168.8.100:8000${rider.vehicle_photo_url}" style="width: 100%; height: auto; border-radius: 8px;" alt="Vehicle Photo">`;
                } else {
                    vehicleContainer.innerHTML = '<span style="color: #9ca3af;">No photo uploaded</span>';
                }
                
                // Show modal
                const modal = document.getElementById('documentModal');
                modal.style.display = 'flex';
            } catch (error) {
                console.error('Error showing documents:', error);
                alert('Failed to load documents');
            }
        }
        
        function closeDocumentModal() {
            document.getElementById('documentModal').style.display = 'none';
            currentModalRiderId = null;
        }
        
        async function approveFromModal() {
            if (!currentModalRiderId) return;
            
            const notes = prompt('Enter approval notes (optional):');
            await verifyRider(currentModalRiderId, true);
            closeDocumentModal();
        }
        
        async function rejectFromModal() {
            if (!currentModalRiderId) return;
            
            await verifyRider(currentModalRiderId, false);
            closeDocumentModal();
        }
        
        // Close modal when clicking outside
        document.getElementById('documentModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeDocumentModal();
            }
        });
        
        function refreshRiders() {
            console.log('üîÑ Refreshing riders...');
            loadRiders();
        }

        function refreshServices() {
            console.log('üîÑ Refreshing services...');
            
            // Visual feedback on button
            const btn = document.getElementById('refresh-services-btn');
            if (btn) {
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚è≥ Refreshing...';
                btn.disabled = true;
                
                // Call loadServices and restore button after completion
                loadServices().finally(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
            } else {
                loadServices();
            }
        }

        // Initialize admin dashboard
        function initAdminDashboard() {
            const storedToken = localStorage.getItem('adminToken');
            const storedAdmin = localStorage.getItem('currentAdmin');
            
            if (storedToken && storedAdmin) {
                adminAuthToken = storedToken;
                try {
                    currentAdmin = JSON.parse(storedAdmin);
                    showAdminDashboard();
                    loadDashboardData();
                } catch (error) {
                    adminLogout();
                }
            }

            // Setup responsive features
            setupResponsiveFeatures();
            
            // Add global debug function
            window.testMobileMenu = function() {
                console.log('Testing mobile menu...');
                toggleMobileMenu();
            };
        }

        // Setup responsive features
        function setupResponsiveFeatures() {
            // Debug function to show current state
            function updateDebugInfo() {
                const debugInfo = document.getElementById('debug-info');
                const toggle = document.getElementById('mobile-menu-toggle');
                const sidebar = document.getElementById('admin-sidebar');
                
                if (debugInfo) {
                    document.getElementById('screen-size').textContent = `${window.innerWidth}x${window.innerHeight}`;
                    document.getElementById('mobile-menu-status').textContent = sidebar?.classList.contains('mobile-open') ? 'Open' : 'Closed';
                    
                    if (toggle) {
                        const computedStyle = window.getComputedStyle(toggle);
                        document.getElementById('toggle-visible').textContent = computedStyle.display !== 'none' ? 'Yes' : 'No';
                    }
                }
            }

            // Show debug info if URL has debug parameter
            if (window.location.search.includes('debug=true')) {
                document.getElementById('debug-info').style.display = 'block';
                setInterval(updateDebugInfo, 1000);
            }

            // Close mobile menu on window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth > 1024) {
                    closeMobileMenu();
                }
                updateDebugInfo();
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                const sidebar = document.getElementById('admin-sidebar');
                const toggle = document.getElementById('mobile-menu-toggle');
                
                if (sidebar && toggle && 
                    !sidebar.contains(e.target) && 
                    !toggle.contains(e.target) && 
                    sidebar.classList.contains('mobile-open')) {
                    closeMobileMenu();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeMobileMenu();
                }
                
                // Handle Enter and Space for mobile menu toggle
                if ((e.key === 'Enter' || e.key === ' ') && 
                    e.target.id === 'mobile-menu-toggle') {
                    e.preventDefault();
                    toggleMobileMenu();
                }
                
                // Debug shortcut: Ctrl+D to toggle debug info
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    const debugInfo = document.getElementById('debug-info');
                    debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
                    if (debugInfo.style.display === 'block') {
                        setInterval(updateDebugInfo, 1000);
                        updateDebugInfo();
                    }
                }
            });

            // Add swipe gesture support for mobile
            let touchStartX = 0;
            let touchStartY = 0;
            
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;
                
                // Only trigger on horizontal swipes (not vertical scrolling)
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    const sidebar = document.getElementById('admin-sidebar');
                    
                    if (sidebar && sidebar.classList.contains('mobile-open') && deltaX < -50) {
                        // Swipe left to close
                        closeMobileMenu();
                    }
                }
            });
            
            updateDebugInfo();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initAdminDashboard);
    </script>
</body>
</html>